---
title: js高级之函数柯里化
date: 2017-09-06 21:09:11
tags: es6
categories: javascript
---

## 基本概念

1. 在数学和计算机科学中，柯里化是一种将使用多个参数的一个函数转换成一系列使用一个参数的函数的技术。--翻译自维基百科
2. 简单的说：柯里函数就是只接受一个参数的函数
3. 例子如下：

```js
function add(a, b) {
  return a + b;
}

// 执行 add 函数，一次传入两个参数即可
add(1, 2); // 3

// 假设有一个 curry 函数可以做到柯里化
var addCurry = curry(add);
addCurry(1)(2); // 3
```

<!-- more -->

## 用途和特点

1. 参数复用 - 复用最初函数的第一个参数
2. 提前返回 – 返回接受余下的参数且返回结果的新函数
3. 延迟执行 – 返回新函数，等待执行

## 函数柯里化的简单实现

step1: Generally speaking ，如果三个数求和的函数我们会这样写：

```js
function _sum3(x, y, z) {
  return x + y + z;
}
```

step2: 如果只考虑实现这个函数的柯里化，我们可以这样做：

```js
function sum3(x) {
  return function(y) {
    return function(z) {
      return x + y + z;
    };
  };
}
console.log(sum3(1)(2)(3)); // 6
```

step4: 观察上面两种不同的写法可以发现，第二种写法其实就是首先把三个参数收集起来，然后到最后再调用第一种写法的函数：

```js
function sum3(x) {
  return function(y) {
    return function(z) {
      return _sum3(x, y, z);
    };
  };
}
console.log(sum3(1)(2)(3)); // 6
```

step5: 所以柯里化的写法只是把常用写法包装了一下，可以使用一个专用的柯里化函数实现这种包装。柯里化函数是一种高阶函数，我们把它命名为 curry

```js
function curry(fn) {
  return function(y) {
    return function(z) {
      return fn(x, y, z);
    };
  };
}
var sum3 = curry((x, y, z) => {
  return x + y + z;
});
console.log(sum3(1)(2)(3)); // 6
```

step6: 如果有要写一种更加通用的，可以柯里化拥有任意多个参数的函数呢，比如 sumN(1)(2)(3)...(N)，按照之前的写法，大概是这个样子的：

```js
function curryN(fn) {
  return function(a1) {
    return function(a2) {
      return function(a3) {
        //......
        return function(aN) {
          return fn(a1, a2, a3, ...aN);
        };
      };
    };
  };
}
```

step7: 很容易想到可以用一个递归函数来简化这种写法，将上面那些看起来相似的函数结构命名为 nest，就可以写为：

```js
function nest(fn) {
  return function(x) {
    return nest(fn);
  };
}
function curry(fn) {
  nest(fn);
}
```

step8: 这里缺少一个循环终止的判断，所以 nest 函数先引入一个新参数 i，当 i === N 时递归终止

```js
function nest(fn, i) {
    return function(x) {
        if (i === N) {
            return fn(...)
        }
        return nest(fn, i + 1)
    }
}
function curry(fn) {
    return nest(fn, 1)
}
```

step9: 接着，需要一个存放任意多个参数的数组，将这个数组命名为 args，然后传入 nest 函数

```js
function nest(fn, i, args) {
  return function(x) {
    args.push(x);
    if (i === fn.length) {
      return fn(...args);
    }
    return nest(fn, i + 1, args);
  };
}
function curry(fn) {
  const args = [];
  return nest(fn, 1, args);
}
```

step10: 最后在添加一个处理 0 个参数的情况，我们就完成了最终版的柯里化函数

```js
function curry(fn) {
  if (fn.length === 0) {
    return fn;
  }
  const args = [];
  return nest(fn, 1, args);
}
```

小试牛刀一下！

```js
const log1 = curry(x => console.log(x));
log1(10); // 10
const mul3 = curry((x, y, z) => console.log(x * y * z));
mul3(2)(3)(4); // 24
```
