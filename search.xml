<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Web站点加速最佳实践</title>
      <link href="/2018/04/08/Best%20Practices%20for%20Speeding%20Up%20Your%20Web%20Site/"/>
      <url>/2018/04/08/Best%20Practices%20for%20Speeding%20Up%20Your%20Web%20Site/</url>
      
        <content type="html"><![CDATA[<p>&emsp;&emsp;Yahoo 的 Exceptional Performance team 总结了页面加载性能优化的黄金 14 条规则， 几年过去了，规则也发展到 7 类 35 条，根据原文翻译整理了一下，<a href="https://developer.yahoo.com/performance/rules.html" target="_blank" rel="noopener">原文地址</a>。规则分为七类：页面内容，服务器，cookie，css，javascript，图片和手机端。 感谢前端工具的发达，如 webpack，eslint，其中很多优化原则都可以让工具自动实施。</p><a id="more"></a><h2 id="页面内容"><a href="#页面内容" class="headerlink" title="页面内容"></a>页面内容</h2><h3 id="减少-HTTP-请求"><a href="#减少-HTTP-请求" class="headerlink" title="减少 HTTP 请求"></a>减少 HTTP 请求</h3><ul><li>合并所有脚本到一个脚本</li><li>合并所有 CSS 到一个 stylesheet</li><li>使用 CSS Sprites 方法减少图片请求：合并背景图到一个图片，然后使用 CSS background-image 和 background-position 属性显示需要的图片片段。</li><li>Image maps 同样是合并多个图片到一个，不过 Image maps 只适用在图片连续的场景, 例如导航条。image maps 的坐标定义繁琐又容易出错， 不推荐使用 image maps。</li><li>使用 inline images，用 data: URL scheme to 嵌入图片到 html 页面，或者合并 inline images 到 stylesheets。 注意，不是所有的浏览器都支持 Inline images。</li></ul><h3 id="减少-DNS-查询"><a href="#减少-DNS-查询" class="headerlink" title="减少 DNS 查询"></a>减少 DNS 查询</h3><p>&emsp;&emsp;大部分浏览器都有独立于操作系统的 DNS 查询结果缓冲, Internet Explorer 默认缓存 30 分钟, Firefox 默认缓存 1 分钟。页面中使用多个主机名称可以提高并行下载数量，但是可能会增加 DNS 查询时间；反过来，减少使用的主机名称，减少 DNS 查询时间，但会降低并行下载数量。在这两者需要取得一个好的平衡，我的原则至少使用两个，但不超过四个主机名称。</p><h3 id="避免重定向"><a href="#避免重定向" class="headerlink" title="避免重定向"></a>避免重定向</h3><p>&emsp;&emsp;Redirects are accomplished using the 301 and 302 status codes. Here’s an example of the HTTP headers in a 301 response:</p><pre><code>HTTP/1.1 301 Moved PermanentlyLocation: http://example.com/newuriContent-Type: text/html</code></pre><p>The browser automatically takes the user to the URL specified in the Location field. All the information necessary for a redirect is in the headers. The body of the response is typically empty. Despite their names, neither a 301 nor a 302 response is cached in practice unless additional headers, such as Expires or Cache-Control, indicate it should be. The meta refresh tag and JavaScript are other ways to direct users to a different URL, but if you must do a redirect, the preferred technique is to use the standard 3xx HTTP status codes, primarily to ensure the back button works correctly.</p><p>The main thing to remember is that redirects slow down the user experience. Inserting a redirect between the user and the HTML document delays everything in the page since nothing in the page can be rendered and no components can start being downloaded until the HTML document has arrived.</p><p>One of the most wasteful redirects happens frequently and web developers are generally not aware of it. It occurs when a trailing slash (/) is missing from a URL that should otherwise have one. For example, going to <a href="http://astrology.yahoo.com/astrology" target="_blank" rel="noopener">http://astrology.yahoo.com/astrology</a> results in a 301 response containing a redirect to <a href="http://astrology.yahoo.com/astrology/" target="_blank" rel="noopener">http://astrology.yahoo.com/astrology/</a> (notice the added trailing slash). This is fixed in Apache by using Alias or mod_rewrite, or the DirectorySlash directive if you’re using Apache handlers.</p><p>Connecting an old web site to a new one is another common use for redirects. Others include connecting different parts of a website and directing the user based on certain conditions (type of browser, type of user account, etc.). Using a redirect to connect two web sites is simple and requires little additional coding. Although using redirects in these situations reduces the complexity for developers, it degrades the user experience. Alternatives for this use of redirects include using Alias and mod_rewrite if the two code paths are hosted on the same server. If a domain name change is the cause of using redirects, an alternative is to create a CNAME (a DNS record that creates an alias pointing from one domain name to another) in combination with Alias or mod_rewrite.</p><h3 id="缓冲-Ajax-响应结果"><a href="#缓冲-Ajax-响应结果" class="headerlink" title="缓冲 Ajax 响应结果"></a>缓冲 Ajax 响应结果</h3><p>&emsp;&emsp; 在 AJAX 响应中增加 Expires 或者 Cache-Control Header。</p><h3 id="Post-load-Components"><a href="#Post-load-Components" class="headerlink" title="Post-load Components"></a>Post-load Components</h3><p>You can take a closer look at your page and ask yourself: “What’s absolutely required in order to render the page initially?”. The rest of the content and components can wait.</p><p>JavaScript is an ideal candidate for splitting before and after the onload event. For example if you have JavaScript code and libraries that do drag and drop and animations, those can wait, because dragging elements on the page comes after the initial rendering. Other places to look for candidates for post-loading include hidden content (content that appears after a user action) and images below the fold.</p><p>Tools to help you out in your effort: YUI Image Loader allows you to delay images below the fold and the YUI Get utility is an easy way to include JS and CSS on the fly.</p><h3 id="提前加载组件"><a href="#提前加载组件" class="headerlink" title="提前加载组件"></a>提前加载组件</h3><p>Preload may look like the opposite of post-load, but it actually has a different goal. By preloading components you can take advantage of the time the browser is idle and request components (like images, styles and scripts) you’ll need in the future. This way when the user visits the next page, you could have most of the components already in the cache and your page will load much faster for the user.</p><p>There are actually several types of preloading:</p><p>Unconditional preload - as soon as onload fires, you go ahead and fetch some extra components. Check google.com for an example of how a sprite image is requested onload. This sprite image is not needed on the google.com homepage, but it is needed on the consecutive search result page.<br>Conditional preload - based on a user action you make an educated guess where the user is headed next and preload accordingly. On search.yahoo.com you can see how some extra components are requested after you start typing in the input box.<br>Anticipated preload - preload in advance before launching a redesign. It often happens after a redesign that you hear: “The new site is cool, but it’s slower than before”. Part of the problem could be that the users were visiting your old site with a full cache, but the new one is always an empty cache experience. You can mitigate this side effect by preloading some components before you even launched the redesign. Your old site can use the time the browser is idle and request images and scripts that will be used by the new site<br>top</p><h3 id="减少-DOM-元素数量"><a href="#减少-DOM-元素数量" class="headerlink" title="减少 DOM 元素数量"></a>减少 DOM 元素数量</h3><p>A complex page means more bytes to download and it also means slower DOM access in JavaScript. It makes a difference if you loop through 500 or 5000 DOM elements on the page when you want to add an event handler for example.</p><p>A high number of DOM elements can be a symptom that there’s something that should be improved with the markup of the page without necessarily removing content. Are you using nested tables for layout purposes? Are you throwing in more <div>s only to fix layout issues? Maybe there’s a better and more semantically correct way to do your markup.</div></p><p>A great help with layouts are the YUI CSS utilities: grids.css can help you with the overall layout, fonts.css and reset.css can help you strip away the browser’s defaults formatting. This is a chance to start fresh and think about your markup, for example use <div>s only when it makes sense semantically, and not because it renders a new line.</div></p><p>The number of DOM elements is easy to test, just type in Firebug’s console:<br>document.getElementsByTagName(‘*‘).length</p><p>And how many DOM elements are too many? Check other similar pages that have good markup. For example the Yahoo! Home Page is a pretty busy page and still under 700 elements (HTML tags).</p><h3 id="Split-Components-Across-Domains"><a href="#Split-Components-Across-Domains" class="headerlink" title="Split Components Across Domains"></a>Split Components Across Domains</h3><p>Splitting components allows you to maximize parallel downloads. Make sure you’re using not more than 2-4 domains because of the DNS lookup penalty. For example, you can host your HTML and dynamic content on <a href="http://www.example.org" target="_blank" rel="noopener">www.example.org</a> and split static components between static1.example.org and static2.example.org</p><p>For more information check “Maximizing Parallel Downloads in the Carpool Lane” by Tenni Theurer and Patty Chi.</p><h3 id="尽量减少使用-iframe"><a href="#尽量减少使用-iframe" class="headerlink" title="尽量减少使用 iframe"></a>尽量减少使用 iframe</h3><p>iframe 帮助第三方内容嵌入，帮助脚本并行下载，但是使用它的代价很大，它会阻塞页面加载</p><h3 id="不使用-404"><a href="#不使用-404" class="headerlink" title="不使用 404"></a>不使用 404</h3><p>一个无用的响应(例如 404 Not Found) 完全没有用处，只会降低用户体验。有些站点使用诸如”Did you mean X?”的 404 响应, 对用户体验有帮助但是浪费了服务器资源(例如数据库等). 如果链接是一个外部的脚本，而返回的响应是 404，尤其糟糕：首先, 脚本下载会阻塞并行下载，其次如果 404 响应的 body 是 JavaScript 代码，浏览器会去解析脚本。</p><h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><h3 id="使用-CDN"><a href="#使用-CDN" class="headerlink" title="使用 CDN"></a>使用 CDN</h3><p>The user’s proximity to your web server has an impact on response times. Deploying your content across multiple, geographically dispersed servers will make your pages load faster from the user’s perspective. But where should you start?</p><p>As a first step to implementing geographically dispersed content, don’t attempt to redesign your web application to work in a distributed architecture. Depending on the application, changing the architecture could include daunting tasks such as synchronizing session state and replicating database transactions across server locations. Attempts to reduce the distance between users and your content could be delayed by, or never pass, this application architecture step.</p><p>Remember that 80-90% of the end-user response time is spent downloading all the components in the page: images, stylesheets, scripts, Flash, etc. This is the Performance Golden Rule. Rather than starting with the difficult task of redesigning your application architecture, it’s better to first disperse your static content. This not only achieves a bigger reduction in response times, but it’s easier thanks to content delivery networks.</p><p>A content delivery network (CDN) is a collection of web servers distributed across multiple locations to deliver content more efficiently to users. The server selected for delivering content to a specific user is typically based on a measure of network proximity. For example, the server with the fewest network hops or the server with the quickest response time is chosen.</p><p>Some large Internet companies own their own CDN, but it’s cost-effective to use a CDN service provider, such as Akamai Technologies, EdgeCast, or level3. For start-up companies and private web sites, the cost of a CDN service can be prohibitive, but as your target audience grows larger and becomes more global, a CDN is necessary to achieve fast response times. At Yahoo!, properties that moved static content off their application web servers to a CDN (both 3rd party as mentioned above as well as Yahoo’s own CDN) improved end-user response times by 20% or more. Switching to a CDN is a relatively easy code change that will dramatically improve the speed of your web site.</p><h3 id="Add-an-Expires-or-a-Cache-Control-Header"><a href="#Add-an-Expires-or-a-Cache-Control-Header" class="headerlink" title="Add an Expires or a Cache-Control Header"></a>Add an Expires or a Cache-Control Header</h3><p>There are two aspects to this rule:</p><p>For static components: implement “Never expire” policy by setting far future Expires header<br>For dynamic components: use an appropriate Cache-Control header to help the browser with conditional requests</p><h3 id="Gzip-Components"><a href="#Gzip-Components" class="headerlink" title="Gzip Components"></a>Gzip Components</h3><p>Starting with HTTP/1.1, web clients indicate support for compression with the Accept-Encoding header in the HTTP request.</p><pre><code>Accept-Encoding: gzip, deflate</code></pre><p>If the web server sees this header in the request, it may compress the response using one of the methods listed by the client. The web server notifies the web client of this via the Content-Encoding header in the response.</p><pre><code>Content-Encoding: gzip</code></pre><h2 id="配置-ETags"><a href="#配置-ETags" class="headerlink" title="配置 ETags"></a>配置 ETags</h2><p>Entity tags (ETags) are a mechanism that web servers and browsers use to determine whether the component in the browser’s cache matches the one on the origin server. (An “entity” is another word a “component”: images, scripts, stylesheets, etc.) ETags were added to provide a mechanism for validating entities that is more flexible than the last-modified date. An ETag is a string that uniquely identifies a specific version of a component. The only format constraints are that the string be quoted. The origin server specifies the component’s ETag using the ETag response header.</p><pre><code>HTTP/1.1 200 OKLast-Modified: Tue, 12 Dec 2006 03:03:59 GMTETag: &quot;10c24bc-4ab-457e1c1f&quot;Content-Length: 12195</code></pre><p>Later, if the browser has to validate a component, it uses the If-None-Match header to pass the ETag back to the origin server. If the ETags match, a 304 status code is returned reducing the response by 12195 bytes for this example.</p><pre><code>GET /i/yahoo.gif HTTP/1.1Host: us.yimg.comIf-Modified-Since: Tue, 12 Dec 2006 03:03:59 GMTIf-None-Match: &quot;10c24bc-4ab-457e1c1f&quot;HTTP/1.1 304 Not Modified</code></pre><p>The problem with ETags is that they typically are constructed using attributes that make them unique to a specific server hosting a site. ETags won’t match when a browser gets the original component from one server and later tries to validate that component on a different server, a situation that is all too common on Web sites that use a cluster of servers to handle requests. By default, both Apache and IIS embed data in the ETag that dramatically reduces the odds of the validity test succeeding on web sites with multiple servers.</p><p>The ETag format for Apache 1.3 and 2.x is inode-size-timestamp. Although a given file may reside in the same directory across multiple servers, and have the same file size, permissions, timestamp, etc., its inode is different from one server to the next.</p><p>IIS 5.0 and 6.0 have a similar issue with ETags. The format for ETags on IIS is Filetimestamp:ChangeNumber. A ChangeNumber is a counter used to track configuration changes to IIS. It’s unlikely that the ChangeNumber is the same across all IIS servers behind a web site.</p><p>The end result is ETags generated by Apache and IIS for the exact same component won’t match from one server to another. If the ETags don’t match, the user doesn’t receive the small, fast 304 response that ETags were designed for; instead, they’ll get a normal 200 response along with all the data for the component. If you host your web site on just one server, this isn’t a problem. But if you have multiple servers hosting your web site, and you’re using Apache or IIS with the default ETag configuration, your users are getting slower pages, your servers have a higher load, you’re consuming greater bandwidth, and proxies aren’t caching your content efficiently. Even if your components have a far future Expires header, a conditional GET request is still made whenever the user hits Reload or Refresh.</p><p>If you’re not taking advantage of the flexible validation model that ETags provide, it’s better to just remove the ETag altogether. The Last-Modified header validates based on the component’s timestamp. And removing the ETag reduces the size of the HTTP headers in both the response and subsequent requests. This Microsoft Support article describes how to remove ETags. In Apache, this is done by simply adding the following line to your Apache configuration file:</p><pre><code>FileETag none</code></pre><h3 id="Flush-the-Buffer-Early"><a href="#Flush-the-Buffer-Early" class="headerlink" title="Flush the Buffer Early"></a>Flush the Buffer Early</h3><p>When users request a page, it can take anywhere from 200 to 500ms for the backend server to stitch together the HTML page. During this time, the browser is idle as it waits for the data to arrive. In PHP you have the function flush(). It allows you to send your partially ready HTML response to the browser so that the browser can start fetching components while your backend is busy with the rest of the HTML page. The benefit is mainly seen on busy backends or light frontends.</p><p>A good place to consider flushing is right after the HEAD because the HTML for the head is usually easier to produce and it allows you to include any CSS and JavaScript files for the browser to start fetching in parallel while the backend is still processing.</p><p>Example:</p><pre><code>  ... &lt;!-- css, js --&gt;&lt;/head&gt;&lt;?php flush(); ?&gt;&lt;body&gt;  ... &lt;!-- content --&gt;</code></pre><p>Yahoo! search pioneered research and real user testing to prove the benefits of using this technique.</p><h3 id="Use-GET-for-AJAX-Requests"><a href="#Use-GET-for-AJAX-Requests" class="headerlink" title="Use GET for AJAX Requests"></a>Use GET for AJAX Requests</h3><p>The Yahoo! Mail team found that when using XMLHttpRequest, POST is implemented in the browsers as a two-step process: sending the headers first, then sending data. So it’s best to use GET, which only takes one TCP packet to send (unless you have a lot of cookies). The maximum URL length in IE is 2K, so if you send more than 2K data you might not be able to use GET.</p><p>An interesting side affect is that POST without actually posting any data behaves like GET. Based on the HTTP specs, GET is meant for retrieving information, so it makes sense (semantically) to use GET when you’re only requesting data, as opposed to sending data to be stored server-side.</p><h3 id="避免-Image-元素的-src-属性为空"><a href="#避免-Image-元素的-src-属性为空" class="headerlink" title="避免 Image 元素的 src 属性为空"></a>避免 Image 元素的 src 属性为空</h3><p>无论是 html 代码中的<code>&lt;img src=&quot;&quot;&gt;</code>或是通过 JavaScript</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var img = new Image();</span><br><span class="line">img.src = &quot;&quot;;</span><br></pre></td></tr></table></figure><p>都导致同样结果: 浏览器多发出一个 http 请求：</p><ul><li>Internet Explorer 会请求页面目录</li><li>Safari 和 Chrome 会请求页面.</li><li>Firefox 3 以及之前的版本如同 Safari 和 Chrome, 不过 3.5 不再发出请求.</li><li>Opera 不会发出请求.</li></ul><p>Why is this behavior bad?</p><p>Cripple your servers by sending a large amount of unexpected traffic, especially for pages that get millions of page views per day.<br>Waste server computing cycles generating a page that will never be viewed.<br>Possibly corrupt user data. If you are tracking state in the request, either by cookies or in another way, you have the possibility of destroying data. Even though the image request does not return an image, all of the headers are read and accepted by the browser, including all cookies. While the rest of the response is thrown away, the damage may already be done.</p><p>HTML5 增加了对 to the description of the tag’s src attribute to instruct browsers not to make an additional request</p><p>The src attribute must be present, and must contain a valid URL referencing a non-interactive, optionally animated, image resource that is neither paged nor scripted. If the base URI of the element is the same as the document’s address, then the src attribute’s value must not be the empty string.<br>Hopefully, browsers will not have this problem in the future. Unfortunately, there is no such clause for <code>&lt;script src=&quot;&quot;&gt;</code> and <code>&lt;link href=&quot;&quot;&gt;</code> Maybe there is still time to make that adjustment to ensure browsers don’t accidentally implement this behavior.<br>This rule was inspired by Yahoo!’s JavaScript guru Nicolas C. Zakas. For more information check out his article “Empty image src can destroy your site”.</p><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><h3 id="减少-Cookie-大小"><a href="#减少-Cookie-大小" class="headerlink" title="减少 Cookie 大小"></a>减少 Cookie 大小</h3><p>HTTP cookies are used for a variety of reasons such as authentication and personalization. Information about cookies is exchanged in the HTTP headers between web servers and browsers. It’s important to keep the size of cookies as low as possible to minimize the impact on the user’s response time.</p><p>For more information check “When the Cookie Crumbles” by Tenni Theurer and Patty Chi. The take-home of this research:</p><p>Eliminate unnecessary cookies<br>Keep cookie sizes as low as possible to minimize the impact on the user response time<br>Be mindful of setting cookies at the appropriate domain level so other sub-domains are not affected<br>Set an Expires date appropriately. An earlier Expires date or none removes the cookie sooner, improving the user response time</p><h3 id="Use-Cookie-free-Domains-for-Components"><a href="#Use-Cookie-free-Domains-for-Components" class="headerlink" title="Use Cookie-free Domains for Components"></a>Use Cookie-free Domains for Components</h3><p>When the browser makes a request for a static image and sends cookies together with the request, the server doesn’t have any use for those cookies. So they only create network traffic for no good reason. You should make sure static components are requested with cookie-free requests. Create a subdomain and host all your static components there.</p><p>If your domain is <a href="http://www.example.org" target="_blank" rel="noopener">www.example.org</a>, you can host your static components on static.example.org. However, if you’ve already set cookies on the top-level domain example.org as opposed to <a href="http://www.example.org" target="_blank" rel="noopener">www.example.org</a>, then all the requests to static.example.org will include those cookies. In this case, you can buy a whole new domain, host your static components there, and keep this domain cookie-free. Yahoo! uses yimg.com, YouTube uses ytimg.com, Amazon uses images-amazon.com and so on.</p><p>Another benefit of hosting static components on a cookie-free domain is that some proxies might refuse to cache the components that are requested with cookies. On a related note, if you wonder if you should use example.org or <a href="http://www.example.org" target="_blank" rel="noopener">www.example.org</a> for your home page, consider the cookie impact. Omitting www leaves you no choice but to write cookies to *.example.org, so for performance reasons it’s best to use the www subdomain and write the cookies to that subdomain.</p><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><h3 id="把-Stylesheets-放在-html-代码的前面"><a href="#把-Stylesheets-放在-html-代码的前面" class="headerlink" title="把 Stylesheets 放在 html 代码的前面"></a>把 Stylesheets 放在 html 代码的前面</h3><p>While researching performance at Yahoo!, we discovered that moving stylesheets to the document HEAD makes pages appear to be loading faster. This is because putting stylesheets in the HEAD allows the page to render progressively.</p><p>Front-end engineers that care about performance want a page to load progressively; that is, we want the browser to display whatever content it has as soon as possible. This is especially important for pages with a lot of content and for users on slower Internet connections. The importance of giving users visual feedback, such as progress indicators, has been well researched and documented. In our case the HTML page is the progress indicator! When the browser loads the page progressively the header, the navigation bar, the logo at the top, etc. all serve as visual feedback for the user who is waiting for the page. This improves the overall user experience.</p><p>The problem with putting stylesheets near the bottom of the document is that it prohibits progressive rendering in many browsers, including Internet Explorer. These browsers block rendering to avoid having to redraw elements of the page if their styles change. The user is stuck viewing a blank white page.</p><p>The HTML specification clearly states that stylesheets are to be included in the HEAD of the page: “Unlike A, [LINK] may only appear in the HEAD section of a document, although it may appear any number of times.” Neither of the alternatives, the blank white screen or flash of unstyled content, are worth the risk. The optimal solution is to follow the HTML specification and load your stylesheets in the document HEAD.</p><h3 id="避免-CSS-表达式"><a href="#避免-CSS-表达式" class="headerlink" title="避免 CSS 表达式"></a>避免 CSS 表达式</h3><p>CSS expressions are a powerful (and dangerous) way to set CSS properties dynamically. They were supported in Internet Explorer starting with version 5, but were deprecated starting with IE8. As an example, the background color could be set to alternate every hour using CSS expressions:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background-color: expression( (new Date()).getHours()%2 ? &quot;#B8D4FF&quot; : &quot;#F08A00&quot; );</span><br></pre></td></tr></table></figure><p>As shown here, the expression method accepts a JavaScript expression. The CSS property is set to the result of evaluating the JavaScript expression. The expression method is ignored by other browsers, so it is useful for setting properties in Internet Explorer needed to create a consistent experience across browsers.</p><p>The problem with expressions is that they are evaluated more frequently than most people expect. Not only are they evaluated when the page is rendered and resized, but also when the page is scrolled and even when the user moves the mouse over the page. Adding a counter to the CSS expression allows us to keep track of when and how often a CSS expression is evaluated. Moving the mouse around the page can easily generate more than 10,000 evaluations.</p><p>One way to reduce the number of times your CSS expression is evaluated is to use one-time expressions, where the first time the expression is evaluated it sets the style property to an explicit value, which replaces the CSS expression. If the style property must be set dynamically throughout the life of the page, using event handlers instead of CSS expressions is an alternative approach. If you must use CSS expressions, remember that they may be evaluated thousands of times and could affect the performance of your page.</p><h3 id="避免使用-CSS-Filter"><a href="#避免使用-CSS-Filter" class="headerlink" title="避免使用 CSS Filter"></a>避免使用 CSS Filter</h3><p>The IE-proprietary AlphaImageLoader filter aims to fix a problem with semi-transparent true color PNGs in IE versions &lt; 7. The problem with this filter is that it blocks rendering and freezes the browser while the image is being downloaded. It also increases memory consumption and is applied per element, not per image, so the problem is multiplied.</p><p>The best approach is to avoid AlphaImageLoader completely and use gracefully degrading PNG8 instead, which are fine in IE. If you absolutely need AlphaImageLoader, use the underscore hack _filter as to not penalize your IE7+ users.</p><h3 id="Choose-over-import"><a href="#Choose-over-import" class="headerlink" title="Choose  over @import"></a>Choose <link> over @import</h3><p>One of the previous best practices states that CSS should be at the top in order to allow for progressive rendering.</p><p>In IE @import behaves the same as using <link> at the bottom of the page, so it’s best not to use it.</p><h2 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h2><h3 id="把-Scripts-放在-html-文件底部"><a href="#把-Scripts-放在-html-文件底部" class="headerlink" title="把 Scripts 放在 html 文件底部"></a>把 Scripts 放在 html 文件底部</h3><p>The problem caused by scripts is that they block parallel downloads. The HTTP/1.1 specification suggests that browsers download no more than two components in parallel per hostname. If you serve your images from multiple hostnames, you can get more than two downloads to occur in parallel. While a script is downloading, however, the browser won’t start any other downloads, even on different hostnames.</p><p>In some situations it’s not easy to move scripts to the bottom. If, for example, the script uses document.write to insert part of the page’s content, it can’t be moved lower in the page. There might also be scoping issues. In many cases, there are ways to workaround these situations.</p><p>An alternative suggestion that often comes up is to use deferred scripts. The DEFER attribute indicates that the script does not contain document.write, and is a clue to browsers that they can continue rendering. Unfortunately, Firefox doesn’t support the DEFER attribute. In Internet Explorer, the script may be deferred, but not as much as desired. If a script can be deferred, it can also be moved to the bottom of the page. That will make your web pages load faster.</p><h3 id="删除重复代码"><a href="#删除重复代码" class="headerlink" title="删除重复代码"></a>删除重复代码</h3><p>It hurts performance to include the same JavaScript file twice in one page. This isn’t as unusual as you might think. A review of the ten top U.S. web sites shows that two of them contain a duplicated script. Two main factors increase the odds of a script being duplicated in a single web page: team size and number of scripts. When it does happen, duplicate scripts hurt performance by creating unnecessary HTTP requests and wasted JavaScript execution.</p><p>Unnecessary HTTP requests happen in Internet Explorer, but not in Firefox. In Internet Explorer, if an external script is included twice and is not cacheable, it generates two HTTP requests during page loading. Even if the script is cacheable, extra HTTP requests occur when the user reloads the page.</p><p>In addition to generating wasteful HTTP requests, time is wasted evaluating the script multiple times. This redundant JavaScript execution happens in both Firefox and Internet Explorer, regardless of whether the script is cacheable.</p><p>One way to avoid accidentally including the same script twice is to implement a script management module in your templating system. The typical way to include a script is to use the SCRIPT tag in your HTML page.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;menu_1.0.17.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>An alternative in PHP would be to create a function called insertScript.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php insertScript(&quot;menu.js&quot;) ?&gt;</span><br></pre></td></tr></table></figure><p>In addition to preventing the same script from being inserted multiple times, this function could handle other issues with scripts, such as dependency checking and adding version numbers to script filenames to support far future Expires headers.</p><h3 id="Minimize-DOM-Access"><a href="#Minimize-DOM-Access" class="headerlink" title="Minimize DOM Access"></a>Minimize DOM Access</h3><p>Accessing DOM elements with JavaScript is slow so in order to have a more responsive page, you should:</p><p>Cache references to accessed elements<br>Update nodes “offline” and then add them to the tree<br>Avoid fixing layout with JavaScript<br>For more information check the YUI theatre’s “High Performance Ajax Applications” by Julien Lecomte.</p><h3 id="Develop-Smart-Event-Handlers"><a href="#Develop-Smart-Event-Handlers" class="headerlink" title="Develop Smart Event Handlers"></a>Develop Smart Event Handlers</h3><p>Sometimes pages feel less responsive because of too many event handlers attached to different elements of the DOM tree which are then executed too often. That’s why using event delegation is a good approach. If you have 10 buttons inside a div, attach only one event handler to the div wrapper, instead of one handler for each button. Events bubble up so you’ll be able to catch the event and figure out which button it originated from.</p><p>You also don’t need to wait for the onload event in order to start doing something with the DOM tree. Often all you need is the element you want to access to be available in the tree. You don’t have to wait for all images to be downloaded. DOMContentLoaded is the event you might consider using instead of onload, but until it’s available in all browsers, you can use the YUI Event utility, which has an onAvailable method.</p><p>For more information check the YUI theatre’s “High Performance Ajax Applications” by Julien Lecomte.</p><h3 id="Make-JavaScript-and-CSS-External"><a href="#Make-JavaScript-and-CSS-External" class="headerlink" title="Make JavaScript and CSS External"></a>Make JavaScript and CSS External</h3><p>tag: javascript, css</p><p>Many of these performance rules deal with how external components are managed. However, before these considerations arise you should ask a more basic question: Should JavaScript and CSS be contained in external files, or inlined in the page itself?</p><p>Using external files in the real world generally produces faster pages because the JavaScript and CSS files are cached by the browser. JavaScript and CSS that are inlined in HTML documents get downloaded every time the HTML document is requested. This reduces the number of HTTP requests that are needed, but increases the size of the HTML document. On the other hand, if the JavaScript and CSS are in external files cached by the browser, the size of the HTML document is reduced without increasing the number of HTTP requests.</p><p>The key factor, then, is the frequency with which external JavaScript and CSS components are cached relative to the number of HTML documents requested. This factor, although difficult to quantify, can be gauged using various metrics. If users on your site have multiple page views per session and many of your pages re-use the same scripts and stylesheets, there is a greater potential benefit from cached external files.</p><p>Many web sites fall in the middle of these metrics. For these sites, the best solution generally is to deploy the JavaScript and CSS as external files. The only exception where inlining is preferable is with home pages, such as Yahoo!’s front page and My Yahoo!. Home pages that have few (perhaps only one) page view per session may find that inlining JavaScript and CSS results in faster end-user response times.</p><p>For front pages that are typically the first of many page views, there are techniques that leverage the reduction of HTTP requests that inlining provides, as well as the caching benefits achieved through using external files. One such technique is to inline JavaScript and CSS in the front page, but dynamically download the external files after the page has finished loading. Subsequent pages would reference the external files that should already be in the browser’s cache.</p><h3 id="Minify-JavaScript-and-CSS"><a href="#Minify-JavaScript-and-CSS" class="headerlink" title="Minify JavaScript and CSS"></a>Minify JavaScript and CSS</h3><p>tag: javascript, css</p><p>Minification is the practice of removing unnecessary characters from code to reduce its size thereby improving load times. When code is minified all comments are removed, as well as unneeded white space characters (space, newline, and tab). In the case of JavaScript, this improves response time performance because the size of the downloaded file is reduced. Two popular tools for minifying JavaScript code are JSMin and YUI Compressor. The YUI compressor can also minify CSS.</p><p>Obfuscation is an alternative optimization that can be applied to source code. It’s more complex than minification and thus more likely to generate bugs as a result of the obfuscation step itself. In a survey of ten top U.S. web sites, minification achieved a 21% size reduction versus 25% for obfuscation. Although obfuscation has a higher size reduction, minifying JavaScript is less risky.</p><p>In addition to minifying external scripts and styles, inlined <code>&lt;script&gt;</code> and <code>&lt;style&gt;</code> blocks can and should also be minified. Even if you gzip your scripts and styles, minifying them will still reduce the size by 5% or more. As the use and size of JavaScript and CSS increases, so will the savings gained by minifying your code.</p><h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><h3 id="Optimize-CSS-Sprites"><a href="#Optimize-CSS-Sprites" class="headerlink" title="Optimize CSS Sprites"></a>Optimize CSS Sprites</h3><p>Arranging the images in the sprite horizontally as opposed to vertically usually results in a smaller file size.<br>Combining similar colors in a sprite helps you keep the color count low, ideally under 256 colors so to fit in a PNG8.<br>“Be mobile-friendly” and don’t leave big gaps between the images in a sprite. This doesn’t affect the file size as much but requires less memory for the user agent to decompress the image into a pixel map. 100x100 image is 10 thousand pixels, where 1000x1000 is 1 million pixels</p><h3 id="不要在-HTML-中缩放图片"><a href="#不要在-HTML-中缩放图片" class="headerlink" title="不要在 HTML 中缩放图片"></a>不要在 HTML 中缩放图片</h3><p>不要使用<br>Don’t use a bigger image than you need just because you can set the width and height in HTML. 例如</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img width=&quot;100&quot; height=&quot;100&quot; src=&quot;mycat.jpg&quot; alt=&quot;My Cat&quot; /&gt;</span><br></pre></td></tr></table></figure><p>图片 mycat.jpg 就应该是 100x100px，而不是一个 500x500px.</p><h3 id="Make-favicon-ico-Small-and-Cacheable"><a href="#Make-favicon-ico-Small-and-Cacheable" class="headerlink" title="Make favicon.ico Small and Cacheable"></a>Make favicon.ico Small and Cacheable</h3><p>The favicon.ico is an image that stays in the root of your server. It’s a necessary evil because even if you don’t care about it the browser will still request it, so it’s better not to respond with a 404 Not Found. Also since it’s on the same server, cookies are sent every time it’s requested. This image also interferes with the download sequence, for example in IE when you request extra components in the onload, the favicon will be downloaded before these extra components.</p><p>So to mitigate the drawbacks of having a favicon.ico make sure:</p><p>It’s small, preferably under 1K.<br>Set Expires header with what you feel comfortable (since you cannot rename it if you decide to change it). You can probably safely set the Expires header a few months in the future. You can check the last modified date of your current favicon.ico to make an informed decision.<br>Imagemagick can help you create small favicons</p><h3 id="Optimize-Images"><a href="#Optimize-Images" class="headerlink" title="Optimize Images"></a>Optimize Images</h3><p>After a designer is done with creating the images for your web page, there are still some things you can try before you FTP those images to your web server.</p><p>You can check the GIFs and see if they are using a palette size corresponding to the number of colors in the image. Using imagemagick it’s easy to check using<br>identify -verbose image.gif<br>When you see an image using 4 colors and a 256 color “slots” in the palette, there is room for improvement.<br>Try converting GIFs to PNGs and see if there is a saving. More often than not, there is. Developers often hesitate to use PNGs due to the limited support in browsers, but this is now a thing of the past. The only real problem is alpha-transparency in true color PNGs, but then again, GIFs are not true color and don’t support variable transparency either. So anything a GIF can do, a palette PNG (PNG8) can do too (except for animations). This simple imagemagick command results in totally safe-to-use PNGs:<br>convert image.gif image.png<br>“All we are saying is: Give PiNG a Chance!”<br>Run pngcrush (or any other PNG optimizer tool) on all your PNGs. Example:<br>pngcrush image.png -rem alla -reduce -brute result.png<br>Run jpegtran on all your JPEGs. This tool does lossless JPEG operations such as rotation and can also be used to optimize and remove comments and other useless information (such as EXIF information) from your images.<br>jpegtran -copy none -optimize -perfect src.jpg dest.jpg</p><h2 id="手机端"><a href="#手机端" class="headerlink" title="手机端"></a>手机端</h2><h3 id="组件-译者注：指的是-html-页面，css，js，图片等等页面内容文件-的大小不要超过-25K"><a href="#组件-译者注：指的是-html-页面，css，js，图片等等页面内容文件-的大小不要超过-25K" class="headerlink" title="组件(译者注：指的是 html 页面，css，js，图片等等页面内容文件)的大小不要超过 25K"></a>组件(译者注：指的是 html 页面，css，js，图片等等页面内容文件)的大小不要超过 25K</h3><p>iPhone 不会缓冲大于 25K 的内容。 值得注意的是 25k 是指解压后的文件大小，单独使用 gzip 不起作用，因此减少文件的大小很重要。</p><p>详情可参看 Wayne Shea 和 Tenni Theurer 写的<a href="http://yuiblog.com/blog/2008/02/06/iphone-cacheability/" target="_blank" rel="noopener">“Performance Research, Part 5: iPhone Cacheability - Making it Stick”</a>.</p><h3 id="Pack-Components-into-a-Multipart-Document"><a href="#Pack-Components-into-a-Multipart-Document" class="headerlink" title="Pack Components into a Multipart Document"></a>Pack Components into a Multipart Document</h3><p>把内容组件打包到一个 multipart 文档，就像带附件的电子邮件, 有助于使用一次 HTTP 请求，获取多个内容组件。使用这个技巧前, 首先检查一下客户端的 user agent 是否支持(iPhone 不支持)。</p>]]></content>
      
      
      <categories>
          
          <category> performance </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高性能Web建设指南摘要</title>
      <link href="/2017/09/06/%E9%AB%98%E6%80%A7%E8%83%BDWeb%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E6%91%98%E8%A6%81/"/>
      <url>/2017/09/06/%E9%AB%98%E6%80%A7%E8%83%BDWeb%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E6%91%98%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<p>性能黄金法则：10 ～ 20%的总响应时间在下载 html 文档，80 ～ 90%的时间在下载页面中的组件(图片，外部样式表、脚本等)。优化的要点是减少占比达 80 ～ 90%页面组件响应时间。</p><a id="more"></a><h2 id="规则-1–减少-HTTP-请求"><a href="#规则-1–减少-HTTP-请求" class="headerlink" title="规则 1–减少 HTTP 请求"></a>规则 1–减少 HTTP 请求</h2><p>运用以下技术减少 http 请求</p><ul><li>图片地图</li><li>CSS Sprites</li><li>内联图片</li><li>合并样式表</li><li>合并脚本</li></ul><h2 id="规则-2–使用内容分发网络"><a href="#规则-2–使用内容分发网络" class="headerlink" title="规则 2–使用内容分发网络"></a>规则 2–使用内容分发网络</h2><p>&emsp;&emsp;内容分布网络(CDN)是一组分布在多个不同地理位置的 Web 服务器。静态内容组件发布到 CDN 后，会在多个 Web 服务器都有拷贝，当用户请求内容组件时，CDN 可选择响应时间最短的 Web 服务器(比如离用户最近的服务器)来完成请求。</p><p>&emsp;&emsp;CDN 不但带来更短的响应时间，而且可以缓解自身服务器的压力。</p><h2 id="规则-3–添加-EXpires-头"><a href="#规则-3–添加-EXpires-头" class="headerlink" title="规则 3–添加 EXpires 头"></a>规则 3–添加 EXpires 头</h2><p>&emsp;&emsp;http 数据包分为头(head)和身体(body)两部分，头部可添加 Expires 和 Cache-Control 来影响浏览器的缓存时间。有两种方法可以设置 http 头</p><ul><li>服务器端在响应请求时设置请求的 http 头。</li><li>html 页面通过 meta 标签的 http-equiv 来设定。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">＜meta http-equiv=&quot;expires&quot; content=&quot;Wed, 20 Jun 2007 22:33:00 GMT&quot;＞</span><br><span class="line">＜meta http-equiv=&quot;Cache-Control&quot; content=&quot;max-age=7200&quot;＞</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;http-equiv 相当于 http 的文件头作用，它可以向浏览器传回一些有用的信息，以帮助正确和精确地显示网页内容。http-equiv 对应的属性值为 content，可设置各个参数的变量值。<br>&emsp;&emsp;客户端(比如 JavaScript 脚本)可以在 HTTP 请求中使用的标准 Cache-Control 指令</p><ul><li>Cache-Control: max-age=&lt;seconds&gt;</li><li>Cache-Control: max-stale[=&lt;seconds&gt;</li><li>Cache-Control: min-fresh=&lt;seconds&gt;</li><li>Cache-control: no-cache</li><li>Cache-control: no-store</li><li>Cache-control: no-transform</li><li>Cache-control: only-if-cached</li></ul><p>&emsp;&emsp;服务器可以在响应中使用的标准 Cache-Control 指令</p><ul><li>Cache-control: must-revalidate</li><li>Cache-control: no-cache</li><li>Cache-control: no-store</li><li>Cache-control: no-transform</li><li>Cache-control: public</li><li>Cache-control: private</li><li>Cache-control: proxy-revalidate</li><li>Cache-Control: max-age=&lt;seconds&gt;</li><li>Cache-control: s-maxage=&lt;seconds&gt;</li></ul><h2 id="规则-4–压缩组件"><a href="#规则-4–压缩组件" class="headerlink" title="规则 4–压缩组件"></a>规则 4–压缩组件</h2><p>Web 客户端可在 http 请求的头部中加入 Accept-Encoding 来标识客户端支持的压缩方法类型（浏览器一般会自动在每次的请求中加入这个头部指令），Web 服务器会用客户端列出来的方法之一来压缩响应结果，并在响应中加入 Content-Encoding:xxx. 最常用的压缩方法是 gzip。</p><ul><li>存在代理和 CDN 的情况会变复杂，解决办法是在服务器的响应头部中加入 Vary: Accept-Encoding</li></ul><h2 id="规则-5–将样式表放在文档顶部"><a href="#规则-5–将样式表放在文档顶部" class="headerlink" title="规则 5–将样式表放在文档顶部"></a>规则 5–将样式表放在文档顶部</h2><p>&emsp;&emsp;浏览器一般会逐步呈现已下载的内容，样式表放在文档底部时，为避免当样式变化时重绘页面中的元素，浏览器会延迟显示任何可视化组件。样式表的放置在底部不会影响下载时间，但是会影响内容的逐步呈现，用户会有更慢的感觉，同时它还和白屏、无样式内容的闪烁相关。</p><h2 id="规则-6–将脚本放在文档底部"><a href="#规则-6–将脚本放在文档底部" class="headerlink" title="规则 6–将脚本放在文档底部"></a>规则 6–将脚本放在文档底部</h2><p>&emsp;&emsp;http 1.1 协议建议浏览器从每个主机名下并行的下载两个组件。 然而，下载脚本时实际上会禁用并行下载-即使使用了不同的主机名。其中的原因是：</p><ul><li>脚本可能使用 document.write 来修改页面内容，因此浏览器会等待，以确保页面能够恰当的布局。</li><li>保证脚本能按正确的顺序执行，如果并行下载多个脚本，页面次序中在后的脚本有可能先下载完成并执行。</li></ul><p>&emsp;&emsp;将脚本放在顶部，会阻塞对其后面内容的呈现，同时阻塞对后面组件的下载。</p><h2 id="规则-7–避免-CSS-表达式"><a href="#规则-7–避免-CSS-表达式" class="headerlink" title="规则 7–避免 CSS 表达式"></a>规则 7–避免 CSS 表达式</h2><p>&emsp;&emsp;CSS expression 方法可接受一个 JavaScript 表达式，很多情况下会导致对其频繁求值，影响浏览器性能。<br>建议使用一次性表达式，或使用 JavaScript 在事件处理中提供动态行为。</p><h2 id="规则-8–使用外部-JavaScript-和-CSS"><a href="#规则-8–使用外部-JavaScript-和-CSS" class="headerlink" title="规则 8–使用外部 JavaScript 和 CSS"></a>规则 8–使用外部 JavaScript 和 CSS</h2><p>&emsp;&emsp;浏览器可以缓存外部 JavaScript 和 CSS，外部的 JavaScript 和 CSS 还可给网站中其他页面共享。</p><ul><li>加载后下载<br>同样的样式表或脚本同时写入到外部文件和内联到页面中，在页面的 onload 事件再次下载含有同样内容的外部文件。内联的样式和脚本让页面呈现更快，同时网站的其他页面可使用已下载的外部样式和脚本文件。需要注意脚本和 CSS 加载两次可能带来的问题。</li></ul><h2 id="规则-9–减少-DNS-查找"><a href="#规则-9–减少-DNS-查找" class="headerlink" title="规则 9–减少 DNS 查找"></a>规则 9–减少 DNS 查找</h2><p>&emsp;&emsp;浏览器会解析 html 页面外部组件所使用主机名称，http 1.1 协议建议每个主机名称两个并行下载；因而在 html 页面中对页面中的组件使用多个主机名称，可提高并行下载数量。然而过多的主机名称，可能不能更好的利用 http 1.1 协议的 keep-alive 特性，同时导致浏览器进行多次 DNS 查找。综合两个考虑，建议在页面中使用至少两个，但不要超过 4 个主机名。</p><h2 id="规则-10–精简（minify）-JavaScript-、-CSS"><a href="#规则-10–精简（minify）-JavaScript-、-CSS" class="headerlink" title="规则 10–精简（minify） JavaScript 、 CSS"></a>规则 10–精简（minify） JavaScript 、 CSS</h2><p>压缩混淆 JavaScript 代码，以减小代码尺寸。同样对 CSS，html 都可使用工具进行 minify。</p><h2 id="规则-11–避免重定向"><a href="#规则-11–避免重定向" class="headerlink" title="规则 11–避免重定向"></a>规则 11–避免重定向</h2><p>一些容易忽视的场景：</p><ul><li>url 指向目录时，结尾不要省略斜线/，不要让 Web 服务器为你发出重定向</li><li>内部流量跟踪，使用 referer 日志跟踪流量取向，而不是使用重定向。</li><li>出战流量跟踪，不实用重定向，而使用信标 beancon–一个在 url 中包含有跟踪信息的 http 请求（信标响应通常是一个 1px X 1px 的透明图片；或者使用 204 响应，因为它更小，从来不会被缓存，而且绝对不会改变浏览器状态。），跟踪信息可以从信标的 web 服务器请求日志中提取出来。</li></ul><p>&emsp;&emsp;使用图片的信标例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;http://en.wikipedia.org/wiki/Performance&quot;</span><br><span class="line">   onclick=&quot;resultBeacon(this); return false;&quot;&gt;Performance - Wikipedia&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var beacon;</span><br><span class="line">function resultBeacon(anchor) &#123;</span><br><span class="line">    beacon = new Image();</span><br><span class="line">    beacon.onload = gotoUrl;</span><br><span class="line">    beacon.onerror = gotoUrl;  // in case the image fails, we still want to redirect the user</span><br><span class="line">  beacon.anchor = anchor;</span><br><span class="line">    beacon.src = &quot;/bin/beacon204.gif?url=&quot; + escape(anchor.href);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function gotoUrl() &#123;</span><br><span class="line">    document.location = beacon.anchor.href;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;使用 XHttpRequest 的信标例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;http://en.wikipedia.org/wiki/Performance&quot;</span><br><span class="line">   onclick=&quot;resultBeacon(this); return false;&quot;&gt;Performance - Wikipedia&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var gAnchor, gXhrObj;</span><br><span class="line"></span><br><span class="line">function resultBeacon(anchor) &#123;</span><br><span class="line">gAnchor = anchor;</span><br><span class="line">  beacon_src = &quot;http://stevesouders.com/images/beacon.gif?url=&quot; + escape(anchor.href) + &quot;&amp;t=&quot; + Number(new Date());</span><br><span class="line"></span><br><span class="line">gXhrObj = getXHRObject();</span><br><span class="line">gXhrObj.onreadystatechange = xhrCallback;</span><br><span class="line">try &#123;</span><br><span class="line">gXhrObj.open(&quot;GET&quot;, beacon_src, true);  // true == async</span><br><span class="line">gXhrObj.send(&quot;&quot;);</span><br><span class="line">&#125;catch(err) &#123;</span><br><span class="line">gotoUrl();  // on failure, just go to the target url</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function xhrCallback(respAr) &#123;</span><br><span class="line">    var readyState = ( respAr &amp;&amp; &quot;undefined&quot; != typeof(respAr.readyState) ? respAr.readyState : gXhrObj.readyState );</span><br><span class="line">    if ( 2 == readyState ) &#123;    // the request is done enough to risk unloading the page</span><br><span class="line">        gotoUrl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function gotoUrl() &#123;</span><br><span class="line">    document.location = gAnchor.href;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Find the right syntax for creating an XHR object.</span><br><span class="line">function getXHRObject() &#123;</span><br><span class="line">    var xhrObj = false;</span><br><span class="line">    try &#123;</span><br><span class="line">        xhrObj = new XMLHttpRequest();</span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        var progid = [&apos;MSXML2.XMLHTTP.5.0&apos;, &apos;MSXML2.XMLHTTP.4.0&apos;, &apos;MSXML2.XMLHTTP.3.0&apos;, &apos;MSXML2.XMLHTTP&apos;, &apos;Microsoft.XMLHTTP&apos;];</span><br><span class="line">        for ( var i=0; i &lt; progid.length; ++i ) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                xhrObj = new ActiveXObject(progid[i]);</span><br><span class="line">            &#125;catch(e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    finally &#123;</span><br><span class="line">        return xhrObj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="规则-12–移除重复脚本"><a href="#规则-12–移除重复脚本" class="headerlink" title="规则 12–移除重复脚本"></a>规则 12–移除重复脚本</h2><p>&emsp;&emsp;团队规模和脚本数量变大，往往会有相同的脚本代码。需要实现一个脚本管理模块，避免重复的脚本。</p><h2 id="规则-13–配置或移除-ETag"><a href="#规则-13–配置或移除-ETag" class="headerlink" title="规则 13–配置或移除 ETag"></a>规则 13–配置或移除 ETag</h2><p>&emsp;&emsp;ETag，Entity Tag-实体标签是 Web 服务器和浏览器用于确认缓存组件有效性的一种机制。条件 Get 请求会比较文件修改日期和 ETag 标签，ETag 标签对于静态文件而言不利。因此建议是在服务器端配置 ETag 或者干脆移除它。</p><h2 id="规则-14–使-AJAX-可缓存"><a href="#规则-14–使-AJAX-可缓存" class="headerlink" title="规则 14–使 AJAX 可缓存"></a>规则 14–使 AJAX 可缓存</h2><p>&emsp;&emsp;某些 AJAX Get 请求可以被缓存，而不影响用户体验。要使这些 AJAX 请求被缓存，需要</p><ul><li>给响应设置 HTTP Cache-Control 或 Expires 头</li><li>请求的 URL 中应包括响应的个性化和动态化数据，这样缓存结果才正确的反映出个性化和动态化。</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> performance </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高性能Web进阶指南摘要</title>
      <link href="/2017/09/06/%E9%AB%98%E6%80%A7%E8%83%BDWeb%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97%E6%91%98%E8%A6%81/"/>
      <url>/2017/09/06/%E9%AB%98%E6%80%A7%E8%83%BDWeb%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97%E6%91%98%E8%A6%81/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> performance </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js高级之函数柯里化</title>
      <link href="/2017/09/06/js%E9%AB%98%E7%BA%A7%E4%B9%8B%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96/"/>
      <url>/2017/09/06/js%E9%AB%98%E7%BA%A7%E4%B9%8B%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ol><li>在数学和计算机科学中，柯里化是一种将使用多个参数的一个函数转换成一系列使用一个参数的函数的技术。–翻译自维基百科</li><li>简单的说：柯里函数就是只接受一个参数的函数</li><li>例子如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 add 函数，一次传入两个参数即可</span></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设有一个 curry 函数可以做到柯里化</span></span><br><span class="line"><span class="keyword">var</span> addCurry = curry(add);</span><br><span class="line">addCurry(<span class="number">1</span>)(<span class="number">2</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="用途和特点"><a href="#用途和特点" class="headerlink" title="用途和特点"></a>用途和特点</h2><ol><li>参数复用 - 复用最初函数的第一个参数</li><li>提前返回 – 返回接受余下的参数且返回结果的新函数</li><li>延迟执行 – 返回新函数，等待执行</li></ol><h2 id="函数柯里化的简单实现"><a href="#函数柯里化的简单实现" class="headerlink" title="函数柯里化的简单实现"></a>函数柯里化的简单实现</h2><p>step1: Generally speaking ，如果三个数求和的函数我们会这样写：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_sum3</span>(<span class="params">x, y, z</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y + z;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>step2: 如果只考虑实现这个函数的柯里化，我们可以这样做：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum3</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">z</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> x + y + z;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(sum3(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><p>step4: 观察上面两种不同的写法可以发现，第二种写法其实就是首先把三个参数收集起来，然后到最后再调用第一种写法的函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum3</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">z</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _sum3(x, y, z);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(sum3(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><p>step5: 所以柯里化的写法只是把常用写法包装了一下，可以使用一个专用的柯里化函数实现这种包装。柯里化函数是一种高阶函数，我们把它命名为 curry</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">z</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> fn(x, y, z);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sum3 = curry(<span class="function">(<span class="params">x, y, z</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y + z;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(sum3(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><p>step6: 如果有要写一种更加通用的，可以柯里化拥有任意多个参数的函数呢，比如 sumN(1)(2)(3)…(N)，按照之前的写法，大概是这个样子的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curryN</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">a1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">a2</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">a3</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//......</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">aN</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> fn(a1, a2, a3, ...aN);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>step7: 很容易想到可以用一个递归函数来简化这种写法，将上面那些看起来相似的函数结构命名为 nest，就可以写为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nest</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nest(fn);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  nest(fn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>step8: 这里缺少一个循环终止的判断，所以 nest 函数先引入一个新参数 i，当 i === N 时递归终止</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nest</span>(<span class="params">fn, i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i === N) &#123;</span><br><span class="line">            <span class="keyword">return</span> fn(...)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nest(fn, i + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nest(fn, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>step9: 接着，需要一个存放任意多个参数的数组，将这个数组命名为 args，然后传入 nest 函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nest</span>(<span class="params">fn, i, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    args.push(x);</span><br><span class="line">    <span class="keyword">if</span> (i === fn.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn(...args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nest(fn, i + <span class="number">1</span>, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> args = [];</span><br><span class="line">  <span class="keyword">return</span> nest(fn, <span class="number">1</span>, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>step10: 最后在添加一个处理 0 个参数的情况，我们就完成了最终版的柯里化函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (fn.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> fn;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> args = [];</span><br><span class="line">  <span class="keyword">return</span> nest(fn, <span class="number">1</span>, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>小试牛刀一下！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> log1 = curry(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br><span class="line">log1(<span class="number">10</span>); <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">const</span> mul3 = curry(<span class="function">(<span class="params">x, y, z</span>) =&gt;</span> <span class="built_in">console</span>.log(x * y * z));</span><br><span class="line">mul3(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>); <span class="comment">// 24</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redux</title>
      <link href="/2017/04/13/redux/"/>
      <url>/2017/04/13/redux/</url>
      
        <content type="html"><![CDATA[<p>我学习 redux 的心得：</p><p>1.单一的状态树，单向数据流</p><p>2.整个项目只有一个 store</p><a id="more"></a><p>3.由用户发出一个 action，reducer 方法接收这个方法和一个老的 state，再重新返回一个新 state,视图再更新</p><p>4.在开发的时候一般会把很多个 reducer 用 redux 里面的 combineReducers 方法合并在一个，便于管理</p>]]></content>
      
      
      <categories>
          
          <category> redux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>es6</title>
      <link href="/2017/04/12/es6/"/>
      <url>/2017/04/12/es6/</url>
      
        <content type="html"><![CDATA[<p>先说一下 let 吧！</p><ol><li>let 和 var 一样用来声明变量，但是不同的是：let 命令只在所在的代码块内有效(es5 没有块级作用域)</li><li>for 循环里面不要再用 var 了，要不然每次输出来的都是最后一个遍历出来的值</li><li>let 不存在变量提升，一定要先声明后使用，要不然报错；而 var 可以先使用再声明，输出来 undefined</li><li>暂时性死区，只要进去作用域，所要使用的变量就已经存在了，但是不可以获取，只有等到变量声明了才可以获取和使用它</li><li>let 不允许在同一作用域内重复声明</li></ol><a id="more"></a><p>为什么需要块级作用域呢？<br>@内层变量可能会覆盖外层变量<br>@用来计数的循环变量泄露为全局变量，很容易造成内存泄漏</p><p>下面再说说 const!</p><ol><li>用来声明常量，所以一旦声明变量，就必须立即初始化，不能留到以后赋值，只声明不赋值，就会报错</li><li>const 的作用域与 let 命令相同：只在声明所在的块级作用域内有效</li><li>const 命令声明的常量也是不提升，同样存在暂时性死区，只能在声明的位置后面使用</li><li>const 声明的常量，也与 let 一样不可重复声明</li></ol><h4 id="结构先不说，比较简单，主要分为数组，对象，字符串，数值，布尔值，函数参数解构"><a href="#结构先不说，比较简单，主要分为数组，对象，字符串，数值，布尔值，函数参数解构" class="headerlink" title="结构先不说，比较简单，主要分为数组，对象，字符串，数值，布尔值，函数参数解构"></a>结构先不说，比较简单，主要分为数组，对象，字符串，数值，布尔值，函数参数解构</h4><p>看了一圈下来，关键是用途，总结一下：</p><ol><li>交换变量的值</li><li>从函数返回多个值</li><li>函数参数的定义</li><li>提取 json 数据(我认为这个比较实用，拿出来可以直接放到视图)</li><li>遍历 Map 结构</li></ol><h4 id="字符串的扩展-下面几个是我认为能用到项目里面频率相对高的"><a href="#字符串的扩展-下面几个是我认为能用到项目里面频率相对高的" class="headerlink" title="字符串的扩展(下面几个是我认为能用到项目里面频率相对高的)"></a>字符串的扩展(下面几个是我认为能用到项目里面频率相对高的)</h4><ol><li>Unicode 表示法：eg:\u{1F680}</li><li>遍历接口器，可以把字符串的每一个字符都遍历出来</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">let</span> codePoint of <span class="string">'foo'</span>) &#123;</span><br><span class="line">    console.log(codePoint)</span><br><span class="line">&#125;</span><br><span class="line">// <span class="string">"f"</span></span><br><span class="line">// <span class="string">"o"</span></span><br><span class="line">// <span class="string">"o"</span></span><br></pre></td></tr></table></figure><ol start="3"><li>at(),这个和 es5 的 charAt()差不多，并且能识别出来码点大于 0xFFFF 的字符</li><li>includes(),startsWith(),endsWith(),he es5 的 indexOf 方法差不多，它返回的是布尔值</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var s = <span class="string">'Hello world!'</span>;</span><br><span class="line"></span><br><span class="line">s.startsWith(<span class="string">'Hello'</span>) // <span class="literal">true</span></span><br><span class="line">s.endsWith(<span class="string">'!'</span>) // <span class="literal">true</span></span><br><span class="line">s.includes(<span class="string">'o'</span>) // <span class="literal">true</span></span><br></pre></td></tr></table></figure><ol start="5"><li>repeat()<br>直接看下面的代码吧</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'x'</span>.repeat(3) // <span class="string">"xxx"</span></span><br><span class="line"><span class="string">'hello'</span>.repeat(2) // <span class="string">"hellohello"</span></span><br><span class="line"><span class="string">'na'</span>.repeat(0) // <span class="string">""</span></span><br></pre></td></tr></table></figure><p>注意：如果是小数，则取整；负数或者 Infinity，报错；0 到-1 的都视为 0；NaN 视为 0</p>]]></content>
      
      
      <categories>
          
          <category> es6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于vue vuex es6 webpack的项目</title>
      <link href="/2017/04/11/%E5%9F%BA%E4%BA%8Evue%20vuex%20es6%20webpack%E7%9A%84%E9%A1%B9%E7%9B%AE/"/>
      <url>/2017/04/11/%E5%9F%BA%E4%BA%8Evue%20vuex%20es6%20webpack%E7%9A%84%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<p>一个基于 vue+vuex+es6+webpack 技术栈的 spa 开店项目</p><a id="more"></a><ol><li>使用了 vue-router 来做页面的路由跳转，主页跳转至详情页面使用具体路由的配置。</li><li>整个项目使用的是 es6 的语法<br>我比较喜欢 es6 的语法，arrow function，let,const,template string，解构,尤其是在 react 里面比较喜欢用的 class,extends,super。</li><li>状态管理用 vuex</li><li>使用 axios 从后端获取数据</li><li>对啦，项目使用的脚手架 vue-cli,快速上手</li><li>github 地址：<a href="https://github.com/chenhx9211/vue-onlineStore" target="_blank" rel="noopener">https://github.com/chenhx9211/vue-onlineStore</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue vuex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react-native 常用的布局：flexbox</title>
      <link href="/2017/04/10/layout/"/>
      <url>/2017/04/10/layout/</url>
      
        <content type="html"><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ol><li>采用 flex 布局的元素就是 flex 容器：flex container.它里面所有的元素都叫子元素：flex item.</li><li>container 容器存在两根轴：水平的主轴(main axis)和垂直的交叉轴(cross axis).主轴起始位置 main start,结束位置 main end,交叉轴起始位置 cross start,结束位置 cross end. 3.项目默认沿着主轴排列.</li></ol><a id="more"></a><h3 id="container-上设置的属性有-6-个"><a href="#container-上设置的属性有-6-个" class="headerlink" title="container 上设置的属性有 6 个"></a>container 上设置的属性有 6 个</h3><ol><li>flex-direction</li><li>flex-wrap</li><li>flex-flow</li><li>justify-content</li><li>align-items</li><li>align-content</li></ol><h3 id="flex-direction-主轴的方向"><a href="#flex-direction-主轴的方向" class="headerlink" title="flex-direction:主轴的方向"></a>flex-direction:主轴的方向</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    flex-direction:row | row-reverse | column | column-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="flex-wrap-如果一条轴线排不下，如何换行"><a href="#flex-wrap-如果一条轴线排不下，如何换行" class="headerlink" title="flex-wrap:如果一条轴线排不下，如何换行"></a>flex-wrap:如果一条轴线排不下，如何换行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    flex-wrap: nowrap | wrap | wrap-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.nowrap:不换行<br>2.wrap：换行，第一行在上方<br>3.wrap-reverse：换行，第一行在下方</p><h3 id="flex-flow：是-flex-direction-和-flex-wrap-的简写"><a href="#flex-flow：是-flex-direction-和-flex-wrap-的简写" class="headerlink" title="flex-flow：是 flex-direction 和 flex-wrap 的简写"></a>flex-flow：是 flex-direction 和 flex-wrap 的简写</h3><h3 id="justify-content：项目在主轴上的对齐方式"><a href="#justify-content：项目在主轴上的对齐方式" class="headerlink" title="justify-content：项目在主轴上的对齐方式"></a>justify-content：项目在主轴上的对齐方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    justify-content: flex-start | flex-end | center | space-between | space-around;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>flex-start：左对齐</li><li>flex-end：右对齐</li><li>center：居中</li><li>space-between：两端对齐，项目之间的间隔都相等</li><li>space-around：每个项目两侧的间隔相等。所以，项目之间的间隔比项目与边框的间隔大一倍</li></ol><h3 id="align-items：项目在交叉轴上如何对齐"><a href="#align-items：项目在交叉轴上如何对齐" class="headerlink" title="align-items：项目在交叉轴上如何对齐"></a>align-items：项目在交叉轴上如何对齐</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    align-items: flex-start | flex-end | center | baseline | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>flex-start：交叉轴的起点对齐</li><li>flex-end：交叉轴的终点对齐</li><li>center：交叉轴的中点对齐</li><li>baseline：项目的第一行文字的基线对齐</li><li>stretch：如果项目未设置高度或设为 auto，将占满整个容器的高度(默认值)</li></ol><h3 id="align-content-定义了多根轴线的对齐方式-如果项目只有一根轴线，该属性不起作用"><a href="#align-content-定义了多根轴线的对齐方式-如果项目只有一根轴线，该属性不起作用" class="headerlink" title="align-content:定义了多根轴线的对齐方式.如果项目只有一根轴线，该属性不起作用"></a>align-content:定义了多根轴线的对齐方式.如果项目只有一根轴线，该属性不起作用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    align-content: flex-start | flex-end | center | space-between | space-around | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="item-上设置的属性有-6-个"><a href="#item-上设置的属性有-6-个" class="headerlink" title="item 上设置的属性有 6 个"></a>item 上设置的属性有 6 个</h3><ol><li>order</li><li>flex-grow</li><li>flex-shrink</li><li>flex-basis</li><li>flex</li><li>align-self</li></ol><h3 id="order-定义项目的排列顺序-数值越小，排列越靠前，默认为-0"><a href="#order-定义项目的排列顺序-数值越小，排列越靠前，默认为-0" class="headerlink" title="order:定义项目的排列顺序.数值越小，排列越靠前，默认为 0."></a>order:定义项目的排列顺序.数值越小，排列越靠前，默认为 0.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">  order: &lt;<span class="built_in">integer</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="flex-grow-定义项目的放大比例，默认为-0，即如果存在剩余空间，也不放大"><a href="#flex-grow-定义项目的放大比例，默认为-0，即如果存在剩余空间，也不放大" class="headerlink" title="flex-grow:定义项目的放大比例，默认为 0，即如果存在剩余空间，也不放大."></a>flex-grow:定义项目的放大比例，默认为 0，即如果存在剩余空间，也不放大.</h3><p>注意：如果一个项目的 flex-grow 属性为 2，其他项目都为 1，则前者占据的剩余空间将比其他项多一倍</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">   flex-grow: &lt;number&gt;; /* default 0 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="flex-shrink：定义了项目的缩小比例，默认为-1，即如果空间不足，该项目将缩小"><a href="#flex-shrink：定义了项目的缩小比例，默认为-1，即如果空间不足，该项目将缩小" class="headerlink" title="flex-shrink：定义了项目的缩小比例，默认为 1，即如果空间不足，该项目将缩小."></a>flex-shrink：定义了项目的缩小比例，默认为 1，即如果空间不足，该项目将缩小.</h3><p>注意：如果所有项目的 flex-shrink 属性都为 1，当空间不足时，都将等比例缩小。如果一个项目的 flex-shrink 属性为 0，其他项目都为 1，则空间不足时，前者不缩小</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">   flex-shrink: &lt;number&gt;; /* default 1 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="flex-basis：定义了在分配多余空间之前，项目占据的主轴空间（main-size）"><a href="#flex-basis：定义了在分配多余空间之前，项目占据的主轴空间（main-size）" class="headerlink" title="flex-basis：定义了在分配多余空间之前，项目占据的主轴空间（main size）."></a>flex-basis：定义了在分配多余空间之前，项目占据的主轴空间（main size）.</h3><p>注意：它可以设为跟 width 或 height 属性一样的值（比如 350px），则项目将占据固定空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">   flex-basis: &lt;length&gt; | auto; /* default auto */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="flex：是-flex-grow-flex-shrink-和-flex-basis-的简写，默认值为-0-1-auto。后两个属性可选"><a href="#flex：是-flex-grow-flex-shrink-和-flex-basis-的简写，默认值为-0-1-auto。后两个属性可选" class="headerlink" title="flex：是 flex-grow, flex-shrink 和 flex-basis 的简写，默认值为 0 1 auto。后两个属性可选."></a>flex：是 flex-grow, flex-shrink 和 flex-basis 的简写，默认值为 0 1 auto。后两个属性可选.</h3><h3 id="align-self-允许单个项目有与其他项目不一样的对齐方式，可覆盖-align-items-属性-默认值为-auto"><a href="#align-self-允许单个项目有与其他项目不一样的对齐方式，可覆盖-align-items-属性-默认值为-auto" class="headerlink" title="align-self:允许单个项目有与其他项目不一样的对齐方式，可覆盖 align-items 属性.默认值为 auto."></a>align-self:允许单个项目有与其他项目不一样的对齐方式，可覆盖 align-items 属性.默认值为 auto.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">   align-self: auto | flex-start | flex-end | center | baseline | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好啦,到此结束！</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li>任何一个元素都可以使用 flex 布局，行内元素使用 display:inline-flex;</li><li>webkit 内核的浏览器必须加上-webkit 前缀：display：-webkit-flex;</li><li>设置 flex 布局以后，子元素的这三个属性将会失效:float,clear,vertical-align.</li></ol>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js设计模式之观察者模式</title>
      <link href="/2016/02/17/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2016/02/17/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
